apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "2"
  creationTimestamp: "2020-11-25T08:36:42Z"
  generation: 2
  labels:
    app: runner-gitlab-runner
    chart: gitlab-runner-0.21.1
    heritage: Tiller
    release: runner
  managedFields:
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:labels:
          .: {}
          f:app: {}
          f:chart: {}
          f:heritage: {}
          f:release: {}
      f:spec:
        f:progressDeadlineSeconds: {}
        f:replicas: {}
        f:revisionHistoryLimit: {}
        f:selector:
          f:matchLabels:
            .: {}
            f:app: {}
        f:strategy:
          f:rollingUpdate:
            .: {}
            f:maxSurge: {}
            f:maxUnavailable: {}
          f:type: {}
        f:template:
          f:metadata:
            f:annotations:
              .: {}
              f:checksum/configmap: {}
              f:checksum/secrets: {}
              f:prometheus.io/port: {}
              f:prometheus.io/scrape: {}
            f:labels:
              .: {}
              f:app: {}
              f:chart: {}
              f:heritage: {}
              f:release: {}
          f:spec:
            f:containers:
              k:{"name":"runner-gitlab-runner"}:
                .: {}
                f:command: {}
                f:env:
                  .: {}
                  k:{"name":"CI_SERVER_URL"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"CLONE_URL"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_CPU_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_CPU_LIMIT_OVERWRITE_MAX_ALLOWED"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_CPU_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_CPU_REQUEST_OVERWRITE_MAX_ALLOWED"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_HELPER_CPU_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_HELPER_CPU_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_HELPER_IMAGE"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_HELPER_MEMORY_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_HELPER_MEMORY_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_IMAGE"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"KUBERNETES_MEMORY_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_MEMORY_LIMIT_OVERWRITE_MAX_ALLOWED"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_MEMORY_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_MEMORY_REQUEST_OVERWRITE_MAX_ALLOWED"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_NAMESPACE"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"KUBERNETES_POLL_TIMEOUT"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"KUBERNETES_PRIVILEGED"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"KUBERNETES_PULL_POLICY"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_SERVICE_ACCOUNT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_SERVICE_CPU_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_SERVICE_CPU_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_SERVICE_MEMORY_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_SERVICE_MEMORY_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"REGISTER_LOCKED"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"RUNNER_EXECUTOR"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"RUNNER_OUTPUT_LIMIT"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"RUNNER_REQUEST_CONCURRENCY"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"RUNNER_TAG_LIST"}:
                    .: {}
                    f:name: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:livenessProbe:
                  .: {}
                  f:exec:
                    .: {}
                    f:command: {}
                  f:failureThreshold: {}
                  f:initialDelaySeconds: {}
                  f:periodSeconds: {}
                  f:successThreshold: {}
                  f:timeoutSeconds: {}
                f:name: {}
                f:ports:
                  .: {}
                  k:{"containerPort":9252,"protocol":"TCP"}:
                    .: {}
                    f:containerPort: {}
                    f:name: {}
                    f:protocol: {}
                f:readinessProbe:
                  .: {}
                  f:exec:
                    .: {}
                    f:command: {}
                  f:failureThreshold: {}
                  f:initialDelaySeconds: {}
                  f:periodSeconds: {}
                  f:successThreshold: {}
                  f:timeoutSeconds: {}
                f:resources: {}
                f:terminationMessagePath: {}
                f:terminationMessagePolicy: {}
                f:volumeMounts:
                  .: {}
                  k:{"mountPath":"/home/gitlab-runner/.gitlab-runner"}:
                    .: {}
                    f:mountPath: {}
                    f:name: {}
                  k:{"mountPath":"/scripts"}:
                    .: {}
                    f:mountPath: {}
                    f:name: {}
                  k:{"mountPath":"/secrets"}:
                    .: {}
                    f:mountPath: {}
                    f:name: {}
            f:dnsPolicy: {}
            f:initContainers:
              .: {}
              k:{"name":"configure"}:
                .: {}
                f:command: {}
                f:env:
                  .: {}
                  k:{"name":"CI_SERVER_URL"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"CLONE_URL"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_CPU_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_CPU_LIMIT_OVERWRITE_MAX_ALLOWED"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_CPU_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_CPU_REQUEST_OVERWRITE_MAX_ALLOWED"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_HELPER_CPU_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_HELPER_CPU_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_HELPER_IMAGE"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_HELPER_MEMORY_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_HELPER_MEMORY_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_IMAGE"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"KUBERNETES_MEMORY_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_MEMORY_LIMIT_OVERWRITE_MAX_ALLOWED"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_MEMORY_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_MEMORY_REQUEST_OVERWRITE_MAX_ALLOWED"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_NAMESPACE"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"KUBERNETES_POLL_TIMEOUT"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"KUBERNETES_PRIVILEGED"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"KUBERNETES_PULL_POLICY"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_SERVICE_ACCOUNT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_SERVICE_CPU_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_SERVICE_CPU_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_SERVICE_MEMORY_LIMIT"}:
                    .: {}
                    f:name: {}
                  k:{"name":"KUBERNETES_SERVICE_MEMORY_REQUEST"}:
                    .: {}
                    f:name: {}
                  k:{"name":"REGISTER_LOCKED"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"RUNNER_EXECUTOR"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"RUNNER_OUTPUT_LIMIT"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"RUNNER_REQUEST_CONCURRENCY"}:
                    .: {}
                    f:name: {}
                    f:value: {}
                  k:{"name":"RUNNER_TAG_LIST"}:
                    .: {}
                    f:name: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:name: {}
                f:resources: {}
                f:terminationMessagePath: {}
                f:terminationMessagePolicy: {}
                f:volumeMounts:
                  .: {}
                  k:{"mountPath":"/config"}:
                    .: {}
                    f:mountPath: {}
                    f:name: {}
                    f:readOnly: {}
                  k:{"mountPath":"/init-secrets"}:
                    .: {}
                    f:mountPath: {}
                    f:name: {}
                    f:readOnly: {}
                  k:{"mountPath":"/secrets"}:
                    .: {}
                    f:mountPath: {}
                    f:name: {}
            f:restartPolicy: {}
            f:schedulerName: {}
            f:securityContext:
              .: {}
              f:fsGroup: {}
              f:runAsUser: {}
            f:serviceAccount: {}
            f:serviceAccountName: {}
            f:terminationGracePeriodSeconds: {}
            f:volumes:
              .: {}
              k:{"name":"etc-gitlab-runner"}:
                .: {}
                f:emptyDir:
                  .: {}
                  f:medium: {}
                f:name: {}
              k:{"name":"init-runner-secrets"}:
                .: {}
                f:name: {}
                f:projected:
                  .: {}
                  f:defaultMode: {}
                  f:sources: {}
              k:{"name":"runner-secrets"}:
                .: {}
                f:emptyDir:
                  .: {}
                  f:medium: {}
                f:name: {}
              k:{"name":"scripts"}:
                .: {}
                f:configMap:
                  .: {}
                  f:defaultMode: {}
                  f:name: {}
                f:name: {}
    manager: Go-http-client
    operation: Update
    time: "2020-11-25T08:36:42Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:spec:
        f:template:
          f:spec:
            f:nodeSelector:
              .: {}
              f:kubernetes.io/os: {}
            f:tolerations: {}
    manager: kubectl-edit
    operation: Update
    time: "2020-11-25T10:22:19Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:annotations:
          .: {}
          f:deployment.kubernetes.io/revision: {}
      f:status:
        f:availableReplicas: {}
        f:conditions:
          .: {}
          k:{"type":"Available"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
          k:{"type":"Progressing"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
        f:observedGeneration: {}
        f:readyReplicas: {}
        f:replicas: {}
        f:updatedReplicas: {}
    manager: kube-controller-manager
    operation: Update
    time: "2020-11-25T10:22:50Z"
  name: runner-gitlab-runner
  namespace: gitlab-managed-apps
  resourceVersion: "30887614"
  selfLink: /apis/apps/v1/namespaces/gitlab-managed-apps/deployments/runner-gitlab-runner
  uid: c12a289b-2ac7-4da6-b078-a059cd410bb8
spec:
  progressDeadlineSeconds: 600
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: runner-gitlab-runner
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      annotations:
        checksum/configmap: 27588a6712112cbc80be649570580db7b450ca38d862526d34681227e892f374
        checksum/secrets: 13ce77a93a4a93b60521ae1018ab884f6cc8381087799b47fa289631f66e24ee
        prometheus.io/port: "9252"
        prometheus.io/scrape: "true"
      creationTimestamp: null
      labels:
        app: runner-gitlab-runner
        chart: gitlab-runner-0.21.1
        heritage: Tiller
        release: runner
    spec:
      containers:
      - command:
        - /bin/bash
        - /scripts/entrypoint
        env:
        - name: CI_SERVER_URL
          value: https://gitlab.fors.ru/
        - name: CLONE_URL
        - name: RUNNER_REQUEST_CONCURRENCY
          value: "1"
        - name: RUNNER_EXECUTOR
          value: kubernetes
        - name: REGISTER_LOCKED
          value: "true"
        - name: RUNNER_TAG_LIST
        - name: RUNNER_OUTPUT_LIMIT
          value: "4096"
        - name: KUBERNETES_IMAGE
          value: ubuntu:16.04
        - name: KUBERNETES_PRIVILEGED
          value: "true"
        - name: KUBERNETES_NAMESPACE
          value: gitlab-managed-apps
        - name: KUBERNETES_POLL_TIMEOUT
          value: "180"
        - name: KUBERNETES_CPU_LIMIT
        - name: KUBERNETES_CPU_LIMIT_OVERWRITE_MAX_ALLOWED
        - name: KUBERNETES_MEMORY_LIMIT
        - name: KUBERNETES_MEMORY_LIMIT_OVERWRITE_MAX_ALLOWED
        - name: KUBERNETES_CPU_REQUEST
        - name: KUBERNETES_CPU_REQUEST_OVERWRITE_MAX_ALLOWED
        - name: KUBERNETES_MEMORY_REQUEST
        - name: KUBERNETES_MEMORY_REQUEST_OVERWRITE_MAX_ALLOWED
        - name: KUBERNETES_SERVICE_ACCOUNT
        - name: KUBERNETES_SERVICE_CPU_LIMIT
        - name: KUBERNETES_SERVICE_MEMORY_LIMIT
        - name: KUBERNETES_SERVICE_CPU_REQUEST
        - name: KUBERNETES_SERVICE_MEMORY_REQUEST
        - name: KUBERNETES_HELPER_CPU_LIMIT
        - name: KUBERNETES_HELPER_MEMORY_LIMIT
        - name: KUBERNETES_HELPER_CPU_REQUEST
        - name: KUBERNETES_HELPER_MEMORY_REQUEST
        - name: KUBERNETES_HELPER_IMAGE
        - name: KUBERNETES_PULL_POLICY
        image: gitlab/gitlab-runner:alpine-v13.4.1
        imagePullPolicy: IfNotPresent
        livenessProbe:
          exec:
            command:
            - /bin/bash
            - /scripts/check-live
          failureThreshold: 3
          initialDelaySeconds: 60
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: runner-gitlab-runner
        ports:
        - containerPort: 9252
          name: metrics
          protocol: TCP
        readinessProbe:
          exec:
            command:
            - /usr/bin/pgrep
            - gitlab.*runner
          failureThreshold: 3
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /secrets
          name: runner-secrets
        - mountPath: /home/gitlab-runner/.gitlab-runner
          name: etc-gitlab-runner
        - mountPath: /scripts
          name: scripts
      dnsPolicy: ClusterFirst
      initContainers:
      - command:
        - sh
        - /config/configure
        env:
        - name: CI_SERVER_URL
          value: https://gitlab.fors.ru/
        - name: CLONE_URL
        - name: RUNNER_REQUEST_CONCURRENCY
          value: "1"
        - name: RUNNER_EXECUTOR
          value: kubernetes
        - name: REGISTER_LOCKED
          value: "true"
        - name: RUNNER_TAG_LIST
        - name: RUNNER_OUTPUT_LIMIT
          value: "4096"
        - name: KUBERNETES_IMAGE
          value: ubuntu:16.04
        - name: KUBERNETES_PRIVILEGED
          value: "true"
        - name: KUBERNETES_NAMESPACE
          value: gitlab-managed-apps
        - name: KUBERNETES_POLL_TIMEOUT
          value: "180"
        - name: KUBERNETES_CPU_LIMIT
        - name: KUBERNETES_CPU_LIMIT_OVERWRITE_MAX_ALLOWED
        - name: KUBERNETES_MEMORY_LIMIT
        - name: KUBERNETES_MEMORY_LIMIT_OVERWRITE_MAX_ALLOWED
        - name: KUBERNETES_CPU_REQUEST
        - name: KUBERNETES_CPU_REQUEST_OVERWRITE_MAX_ALLOWED
        - name: KUBERNETES_MEMORY_REQUEST
        - name: KUBERNETES_MEMORY_REQUEST_OVERWRITE_MAX_ALLOWED
        - name: KUBERNETES_SERVICE_ACCOUNT
        - name: KUBERNETES_SERVICE_CPU_LIMIT
        - name: KUBERNETES_SERVICE_MEMORY_LIMIT
        - name: KUBERNETES_SERVICE_CPU_REQUEST
        - name: KUBERNETES_SERVICE_MEMORY_REQUEST
        - name: KUBERNETES_HELPER_CPU_LIMIT
        - name: KUBERNETES_HELPER_MEMORY_LIMIT
        - name: KUBERNETES_HELPER_CPU_REQUEST
        - name: KUBERNETES_HELPER_MEMORY_REQUEST
        - name: KUBERNETES_HELPER_IMAGE
        - name: KUBERNETES_PULL_POLICY
        image: gitlab/gitlab-runner:alpine-v13.4.1
        imagePullPolicy: IfNotPresent
        name: configure
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /secrets
          name: runner-secrets
        - mountPath: /config
          name: scripts
          readOnly: true
        - mountPath: /init-secrets
          name: init-runner-secrets
          readOnly: true
      nodeSelector:
        kubernetes.io/os: linux
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext:
        fsGroup: 65533
        runAsUser: 100
      serviceAccount: runner-gitlab-runner
      serviceAccountName: runner-gitlab-runner
      terminationGracePeriodSeconds: 3600
      tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/master
      volumes:
      - emptyDir:
          medium: Memory
        name: runner-secrets
      - emptyDir:
          medium: Memory
        name: etc-gitlab-runner
      - name: init-runner-secrets
        projected:
          defaultMode: 420
          sources:
          - secret:
              items:
              - key: runner-registration-token
                path: runner-registration-token
              - key: runner-token
                path: runner-token
              name: runner-gitlab-runner
      - configMap:
          defaultMode: 420
          name: runner-gitlab-runner
        name: scripts
status:
  availableReplicas: 1
  conditions:
  - lastTransitionTime: "2020-11-25T08:37:14Z"
    lastUpdateTime: "2020-11-25T08:37:14Z"
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: "True"
    type: Available
  - lastTransitionTime: "2020-11-25T08:36:42Z"
    lastUpdateTime: "2020-11-25T10:22:50Z"
    message: ReplicaSet "runner-gitlab-runner-7c9557ccd9" has successfully progressed.
    reason: NewReplicaSetAvailable
    status: "True"
    type: Progressing
  observedGeneration: 2
  readyReplicas: 1
  replicas: 1
  updatedReplicas: 1
